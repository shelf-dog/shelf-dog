{"files":[{"id":"58fe416e-13bb-4acc-b485-f829a25dea2b","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/London\",\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"Drive\",\n        \"serviceId\": \"drive\",\n        \"version\": \"v2\"\n      }\n    ],\n    \"libraries\": [\n      {\n        \"userSymbol\": \"SAAD\",\n        \"libraryId\": \"1D-FTHDV4Xjk6YIlTuV7dRiNThUZm6s5oeBMqvK-6q8keGsrKjEpzoIjL\",\n        \"version\": \"8\"\n      },\n      {\n        \"userSymbol\": \"CONFIG\",\n        \"libraryId\": \"1pF0iA0f5Kl_QDPEhG6hXFKSfeQ9uYrzphh1eZegTUyqbMhohOZl8AEzQ\",\n        \"version\": \"7\"\n      },\n      {\n        \"userSymbol\": \"WEBAPI\",\n        \"libraryId\": \"1IxhmaGfGcOnW2rXMYW4ExFxrk9NzHpHwV_0n-h0R4aZdIcuApBwvzWsk\",\n        \"version\": \"14\"\n      },\n      {\n        \"userSymbol\": \"SHOWDOWN\",\n        \"libraryId\": \"1yr8mwTX7hqCMF4SzbSdiOVANPZ8tYjv6r-zAlzbvHcmkEWpu8zn9UGtC\",\n        \"version\": \"1\"\n      }\n    ]\n  },\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"f17889a0-8c8b-4c5d-8379-58fc3cf5209b","name":"Entry","type":"server_js","source":"/**\n * Creates a custom menu in Google Sheets when the spreadsheet opens.\n */\nfunction onInstall(e) {\n  onOpen(e);\n};\n\nfunction onOpen() {\n  var ui \u003d SpreadsheetApp.getUi();\n  \n  var menu \u003d ui.createMenu(\"Tasks\")\n              .addItem(\"Authorise\", \"authoriseServer\");\n  if (config.get_capabilities_loan_length()) menu.addItem(\"Send Overdue Notifications\", \"sendOverdueNotifications\");\n  \n  menu.addToUi();\n};\n\nfunction authoriseServer() {\n  ScriptApp.getOAuthToken();\n};"},{"id":"a3e0a89b-86fc-4043-83a3-aba6935d58c5","name":"Server","type":"server_js","source":"// -- SERVER FUNCTIONS -- //\nfunction doGet(e){\n  return WEBAPI.handleResponse(e, API(), PUBLIC_KEY);\n}\n\nfunction doPost(e){\n  return WEBAPI.handleResponse(e, API(), PUBLIC_KEY);\n}\n// -- SERVER FUNCTIONS -- //"},{"id":"ec3d06eb-043b-469d-a77b-791947b775c1","name":"API","type":"server_js","source":"var API \u003d () \u003d\u003e {\n  \n  var _check \u003d (user, value) \u003d\u003e value \u0026\u0026 user ? \n        typeof value \u003d\u003d\u003d \"object\" \u0026\u0026 value.constructor \u003d\u003d\u003d Array ? value.indexOf(user) \u003e\u003d 0 : \n        new RegExp(Utilities.formatString(\"(^|,)(%s)(,|$)\", user.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$\u0026\")), \"i\").test(value) : \n      false;\n      \n  var _claims \u003d (user, claims) \u003d\u003e {\n    if (_check(user, config.get_managers())) claims.manage \u003d true;\n    if (user \u003d\u003d\u003d Session.getActiveUser().getEmail()) claims.owner \u003d true;\n    return claims;\n  };\n  \n  var _sheet \u003d (name, key, value) \u003d\u003e {\n    var _spreadsheet \u003d SpreadsheetApp.getActiveSpreadsheet(),\n        _sheet \u003d _spreadsheet.getSheetByName(name);\n        \n    if (!_sheet) {\n      var _sheets \u003d _spreadsheet.getSheets()\n        .filter(sheet \u003d\u003e {\n          var _metadata \u003d _sheet.getDeveloperMetadata();\n          return _metadata.some(metadata \u003d\u003e {\n            return metadata.getKey() \u003d\u003d key \u0026\u0026 metadata.getValue() \u003d\u003d value;\n          });\n        });\n      if (_sheets \u0026\u0026 _sheets.length \u003d\u003d\u003d 1) _sheet \u003d _sheets[0];\n    }\n    \n    return _sheet;\n  };\n  \n  var _sheets \u003d {\n  \n    current : () \u003d\u003e _sheet(\"CURRENT LOANS\", \"TYPE\", \"CURRENT_LOANS\"),\n    \n    users : () \u003d\u003e _sheet(\"USERS\", \"TYPE\", \"USERS\"),\n\n    requests : () \u003d\u003e _sheet(\"REQUESTS\", \"TYPE\", \"REQUESTS\"),\n  \n  };\n  \n  var _current \u003d () \u003d\u003e {\n    var _data \u003d _sheets.current();\n    return _data ? SAAD.DB().sheet(_data, _data.getParent(), {Range : \"A:I\", Header : 1}).get().query() : [];\n  };\n  \n  var _pending \u003d () \u003d\u003e {\n    var _data \u003d _sheets.requests();\n    return _data ? SAAD.DB().sheet(_data, _data.getParent(), {Range : \"A:E\", Header : 1}).get().query() : [];\n  };\n  \n\n  var _users \u003d () \u003d\u003e {\n    var _data \u003d _sheets.users();\n    return _data ? SAAD.DB().sheet(_data, _data.getParent(), {Range : \"A:E\", Header : 1}).get().query() : [];\n  };\n  \n  var _available \u003d (params) \u003d\u003e {\n    var _data \u003d _current();\n\n    return params.copies.split(\",\").map((copy) \u003d\u003e {\n      var _loans \u003d _data.filter((loan) \u003d\u003e {\n        return loan.COPY \u003d\u003d copy \u0026\u0026 (loan.RETURNED \u003d\u003d null || loan.RETURNED \u003d\u003d \"\");\n      });\n      return {\n        copy: copy,\n        available: _loans.length \u003d\u003d\u003d 0 ? true : false\n      };\n    });\n\n  };\n  \n  var _details \u003d (user) \u003d\u003e {\n    var _display \u003d _users().filter((row) \u003d\u003e row.ID \u0026\u0026 row.ID.toLowerCase \u0026\u0026 row.ID.toLowerCase() \u003d\u003d user);\n    if (_display \u0026\u0026 _display.length \u003d\u003d\u003d 1) {\n      return {\n        display: _display[0].DISPLAY_NAME,\n        search: _display[0].CUSTOM_SEARCHES \u0026\u0026 _display[0].CUSTOM_SEARCHES.split ? \n                  _display[0].CUSTOM_SEARCHES.split(\"\\n\")\n                    .filter((search) \u003d\u003e !!search)\n                    .map((search) \u003d\u003e {\n                      if (/^\\[.+].+$/.test(search \u003d search.trim())) {\n                        var _matched \u003d /^\\[(.+)](.+)$/.exec(search);\n                        return {\n                          name: _matched[1],\n                          search: _matched[2],\n                        };\n                      } else {\n                        return search;\n                      }\n                    }) : null,\n      };\n    }\n  };\n  \n  var _folder \u003d (path) \u003d\u003e {\n\n    var _path \u003d path.split(\"/\"),\n        _folder \u003d config.get_folder();\n          \n    if (!_folder) return;\n    _folder \u003d DriveApp.getFolderById(_folder);\n    _path.forEach((path) \u003d\u003e {\n      if (_folder) {\n        var __folder \u003d _folder.getFoldersByName(path);\n        _folder \u003d __folder.hasNext() ? __folder.next() : null;\n      }\n    });\n      \n    return _folder;\n\n  };\n\n  var _file \u003d (path, name, search) \u003d\u003e {\n  \n    var _holder \u003d _folder(path);\n    if (!_holder) return;\n    \n    var _file \u003d search ? _holder.searchFiles(Utilities.formatString(\u0027title contains \"%s\"\u0027, name)) : _holder.getFilesByName(name);\n      \n    return _file.hasNext() ? _file.next() : null;\n    \n  };\n\n  var _log \u003d {\n\n    concluded : (params, user) \u003d\u003e {\n      var _requests \u003d _pending().filter((request) \u003d\u003e request.ID \u003d\u003d params.id \u0026\u0026 request.USER \u003d\u003d params.user);\n  \n      if (_requests.length \u003d\u003d 1) {\n        _sheets.requests().deleteRow(_requests[0].$SaaD.row + 1);\n        _requests[0].CONCLUDED \u003d true;\n        if (params.loaned) {\n          params.isbn \u003d _requests[0].ISBN;\n          params.details \u003d _requests[0].DETAILS;\n          return _log.loaned(params, user);\n        } else {\n          return _requests[0];\n        }\n      }\n    },\n\n    loaned : (params, user) \u003d\u003e {\n      _sheets.current().appendRow([\n        new Date().toISOString(),\n        Utilities.formatString(\"\u0027%s\", params.id),\n        params.isbn ? Utilities.formatString(\"\u0027%s\", params.isbn) : \"\",\n        Utilities.formatString(\"\u0027%s\", params.copy || params.id),\n        params.user,\n        \"\",\n        user,\n        \u0027\u003dIF(LEN(INDIRECT(\"R\"\u0026ROW()\u0026\"C6\", FALSE))\u003d0,HYPERLINK(\"https://shelf.dog/app/manage/#google,library.\"\u0026CODE\u0026\".search.\"\u0026INDIRECT(\"R\"\u0026ROW()\u0026\"C4\", FALSE),\"Open\"),)\u0027,\n        params.details || \"\"\n      ]);\n      \n      return _available({\n        copies: params.copy || params.id\n      });\n    },\n    \n    returned : (params, user) \u003d\u003e {\n      var _loans \u003d _current().filter((loan) \u003d\u003e (loan.RETURNED \u003d\u003d null || loan.RETURNED \u003d\u003d \"\") \u0026\u0026 loan.COPY \u003d\u003d params.copy);\n  \n      if (_loans.length \u003d\u003d 1) {\n        _sheets.current().getRange(_loans[0].$SaaD.row + 1, 6, 1, 2).setValues([[new Date().toISOString(), user]]);\n        return _available({\n          copies: params.copy\n        });\n      }\n    },\n  };\n  \n  return {\n  \n    meta : (params, user, claims) \u003d\u003e {\n    \n      return {\n        description: config.get_description(),\n        type: \"BOOKS\",\n        version: 1,\n        capabilities: {\n          loan: config.get_capabilities_loan(),\n          loan_field: config.get_capabilities_loan_field(),\n          loan_length: config.get_capabilities_loan_length(),\n          loan_requests: config.get_capabilities_loan_requests(),\n          online_items: config.get_capabilities_online_items(),\n        },\n        contents: {\n          books: {\n            audio: config.get_contents_books_audio(),\n            electronic: config.get_contents_books_electronic(),\n            physical: config.get_contents_books_physical(),\n          }\n        },\n        recent: config.get_recent_items(),\n        actions: {\n\n          meta: {\n            description : \"Provides information about this API, and it\u0027s capabilities.\"\n          },\n\n          db: {\n            description : \"Returns the DB Catalog File for the Library.\"\n          },\n          hash: {\n            description : \"Gets the computed binary hash of the DB Catalog File, to allow monitoring for changes.\"\n          },\n\n          settings: {\n            description : \"Gets / Sets the settings for this library.\",\n            level : \"ADMIN\"\n          },\n\n          cover: {\n            description : \"Gets the Cover Link (if link param is supplied) or Cover Bytes for an Item.\"\n          },\n          available: {\n            description : \"Gets the Copy Availability\"\n          },\n          loans: {\n            description : \"Gets Loans for User, Copy or Outstanding (Current - needs MANAGER level) depending on params supplied\",\n          },\n          download: {\n            description : \"Downloads an item from the library (e.g. a book, for reading)\",\n          },\n\n          request: {\n            description : \"Add Request for a Copy/Item\",\n          },\n          requests: {\n            description : \"Gets Requests for User, ID or Outstanding (Current - needs MANAGER level) depending on params supplied\",\n          },\n\n          path: {\n            description : \"Get the folder path for an item\",\n            level : \"MANAGER\"\n          },\n\n          statistics: {\n            description : \"Gets Calculated Statistics for all Loans\",\n            level : \"MANAGER\"\n          },\n\n          log_concluded: {\n            description : \"Log Copy/Item Request as Concluded (Fulfilled / Cleared)\",\n            level : \"MANAGER\"\n          },\n          log_loaned: {\n            description : \"Log Copy/Item as Loaned\",\n            level : \"MANAGER\"\n          },\n          log_returned: {\n            description : \"Log Copy/Item as Returned\",\n            level : \"MANAGER\"\n          },\n          users: {\n            description : \"Gets User List (for names and links)\",\n            level : \"MANAGER\"\n          },\n        },\n        user: user,\n        details: _details(user),\n        claims: _claims(user, claims)\n      }\n    },\n    \n\n    hash : () \u003d\u003e {\n      var _db \u003d config.get_database();\n      return _db ? Drive.Files.get(_db, {\n          supportsAllDrives: true,\n          supportsTeamDrives: true\n        }).md5Checksum : \"\";\n    },\n    \n    db : (params) \u003d\u003e {\n      var _db \u003d config.get_database();\n          _bytes \u003d () \u003d\u003e DriveApp.getFileById(_db).getBlob().getBytes();\n      return _db ? {\n        hash : Drive.Files.get(_db, {\n          supportsAllDrives: true,\n          supportsTeamDrives: true\n        }).md5Checksum,\n        data : params \u0026\u0026 params.base64 ? Utilities.base64Encode(_bytes()) : _bytes()\n      } : \"\";\n    },\n    \n    settings : (params, user, claims) \u003d\u003e {\n      if (!claims || !claims.admin) return;\n      if (Object.keys(params).length \u003e 0) config.set(params);\n      return config.get();\n    },\n    \n\n    cover : (params) \u003d\u003e {\n      if (!params || !params.path) return;\n      var _cover \u003d _file(params.path, \"cover.jpg\");\n      \n      if (!_cover) return;\n\n      var _bytes \u003d () \u003d\u003e _cover.getBlob().getBytes(),\n          __bytes \u003d () \u003d\u003e params.base64 ? Utilities.base64Encode(_bytes()) : _bytes();\n\n      return params.link \u0026\u0026 params.link !\u003d \"false\" ? Drive.Files.get(_cover.getId(), {\n          supportsAllDrives: true,\n          supportsTeamDrives: true\n        }).thumbnailLink || __bytes() : __bytes();\n    },\n    \n    available : (params) \u003d\u003e {\n      if (!params || !params.copies) return;\n      return _available(params);\n    },\n\n    loans : (params, user, claims) \u003d\u003e {\n      var _authorised \u003d claims \u0026\u0026 (claims \u003d _claims(user, claims)).manage;\n      _authorised \u003d _authorised ? _authorised : (params \u0026\u0026 params.user \u0026\u0026 params.user.toLowerCase() \u003d\u003d user.toLowerCase());\n      if (!_authorised || !config.get_capabilities_loan()) return;\n      \n      var _overdue \u003d params.overdue ? (() \u003d\u003e {\n        var _now \u003d new Date(),\n            _overdue \u003d config.get_capabilities_loan_length();\n        if (_overdue) _overdue \u003d _overdue * 24 * 60 * 60 * 1000;\n        return (loan) \u003d\u003e {\n          if (!_overdue) return false;\n          var _loaned \u003d loan.DATE ? loan.DATE instanceof Date ? loan.DATE : new Date(loan.DATE) : false;\n          return _loaned \u0026\u0026 !loan.RETURNED \u0026\u0026 (_now - _loaned) \u003e _overdue;\n        };\n      })() : null;\n      \n      return _current()\n        .filter((loan) \u003d\u003e params.user ? \n          loan.USER \u0026\u0026 (loan.USER.toLowerCase ? loan.USER.toLowerCase() \u003d\u003d params.user.toLowerCase() : loan.USER \u003d\u003d params.user) : \n            params.copy ? loan.COPY \u003d\u003d params.copy :\n              params.overdue ? _overdue(loan) :\n                params.returned ? !!loan.RETURNED :\n                params.all ? true :\n                (loan.RETURNED \u003d\u003d null || loan.RETURNED \u003d\u003d \"\"))\n        .map((loan) \u003d\u003e {\n          var _return \u003d {\n            id: loan.ID,\n            date: loan.DATE,\n            isbn: loan.ISBN,\n            copy: loan.COPY\n          };\n          if (claims \u0026\u0026 claims.manage) {\n            _return.user \u003d loan.USER;\n            _return.returned \u003d loan.RETURNED;\n            _return.last \u003d loan.AUTH_USER;\n            if (params.details) _return.details \u003d loan.DETAILS;\n          } else {\n            _return.returned \u003d !!loan.RETURNED;\n          }\n          return _return;\n        });\n    },\n\n    download : (params) \u003d\u003e {\n      if (!params || !params.path || !params.name) return;\n      if (!config.get_capabilities_online_items()) return;\n      var _download \u003d _file(params.path, params.name, true),\n          _bytes \u003d () \u003d\u003e _download.getBlob().getBytes();\n      \n      return _download ? {\n        type: _download.getMimeType(),\n        data: params.base64 ? Utilities.base64Encode(_bytes()) : _download.getBlob().getBytes(_bytes())\n      } : null;\n      \n    },\n\n\n    request : (params, user, claims) \u003d\u003e {\n\n      var _authorised \u003d claims \u0026\u0026 (claims \u003d _claims(user, claims)).manage;\n      _authorised \u003d _authorised ? _authorised : (params \u0026\u0026 params.user \u0026\u0026 params.user.toLowerCase() \u003d\u003d user.toLowerCase());\n      if (!_authorised || !params || !params.user || !params.id || !config.get_capabilities_loan_requests()) return;\n\n      var _existing \u003d _pending()\n        .filter((request) \u003d\u003e request.USER \u0026\u0026 \n          (request.USER.toLowerCase ? request.USER.toLowerCase() \u003d\u003d params.user.toLowerCase() : request.USER \u003d\u003d params.user) \u0026\u0026\n          request.ID \u0026\u0026 request.ID \u003d\u003d params.id)\n        .sort((a, b) \u003d\u003e a.DATE \u003e b.DATE ? 1 : a.DATE \u003c b.DATE ? -1 : 0);\n\n      if (_existing \u0026\u0026 _existing.length \u003e\u003d 1) {\n\n        return {\n          type: \"EXISTING\",\n          requested: _existing[0].DATE\n        };\n\n      } else {\n\n        var _requested \u003d new Date().toISOString();\n        _sheets.requests().appendRow([\n          _requested,\n          Utilities.formatString(\"\u0027%s\", params.id),\n          params.isbn ? Utilities.formatString(\"\u0027%s\", params.isbn) : \"\",\n          params.user,\n          params.details || \"\"\n        ]);\n\n        return {\n          type: \"NEW\",\n          requested: _requested\n        };\n\n      }\n      \n    },\n\n    requests : (params, user, claims) \u003d\u003e {\n      var _authorised \u003d claims \u0026\u0026 (claims \u003d _claims(user, claims)).manage;\n      _authorised \u003d _authorised ? _authorised : (params \u0026\u0026 params.user \u0026\u0026 params.user.toLowerCase() \u003d\u003d user.toLowerCase());\n      if (!_authorised || !config.get_capabilities_loan_requests()) return;\n\n      return _pending()\n        .filter((request) \u003d\u003e params.user ? request.USER \u0026\u0026 \n          (request.USER.toLowerCase ? request.USER.toLowerCase() \u003d\u003d params.user.toLowerCase() : request.USER \u003d\u003d params.user) : \n            params.id ? request.ID \u003d\u003d params.id : true)\n        .map((request) \u003d\u003e {\n          var _return \u003d {\n            id: request.ID,\n            date: request.DATE,\n            isbn: request.ISBN,\n          };\n          if (claims \u0026\u0026 claims.manage) {\n            _return.user \u003d request.USER\n            if (params.details) _return.details \u003d request.DETAILS;\n          }\n          return _return;\n        });\n    },\n \n    \n    folder : (params, user, claims) \u003d\u003e {\n      if (!claims || !(claims \u003d _claims(user, claims)).manage) return;\n      if (!params || !params.path) return;\n\n      var _holder \u003d _folder(params.path);\n\n      return _holder ? _holder.getUrl() : null;\n      \n    },\n\n    statistics : (params, user, claims) \u003d\u003e {\n      if (!claims || !(claims \u003d _claims(user, claims)).manage) return;\n      var _week \u003d (value) \u003d\u003e {\n            var d \u003d new Date(Date.UTC(value.getFullYear(), value.getMonth(), value.getDate()));\n            var dayNum \u003d d.getUTCDay() || 7;\n            d.setUTCDate(d.getUTCDate() + 4 - dayNum);\n            var yearStart \u003d new Date(Date.UTC(d.getUTCFullYear(),0,1));\n            return Math.ceil((((d - yearStart) / 86400000) + 1)/7)\n          },\n          _now \u003d new Date(),\n          _overdue \u003d config.get_capabilities_loan_length();\n      if (_overdue) _overdue \u003d _overdue * 24 * 60 * 60 * 1000;\n      var _return \u003d _current().reduce((memo, loan) \u003d\u003e {\n        memo.loaned +\u003d 1;\n        loan.RETURNED ? memo.returned +\u003d 1 : memo.outstanding +\u003d 1;\n        var _loaned \u003d loan.DATE ? loan.DATE instanceof Date ? loan.DATE : new Date(loan.DATE) : false,\n            _returned \u003d loan.RETURNED ? loan.RETURNED instanceof Date ? loan.RETURNED : Date.parse(loan.RETURNED) : false;\n        if (_loaned) {\n          var _key \u003d Utilities.formatString(\"%s-%s\", _loaned.getFullYear(), _week(_loaned));\n          memo.weeks[_key] \u003d memo.weeks[_key] ? memo.weeks[_key] +\u003d 1 : 1; \n        }\n        if (_loaned \u0026\u0026 _returned \u0026\u0026 _returned \u003e _loaned) memo.durations.push(_returned - _loaned);\n        if (_loaned \u0026\u0026 !_returned \u0026\u0026 _overdue \u0026\u0026 (_now - _loaned) \u003e _overdue) memo.overdue +\u003d 1;\n        return memo;\n      }, {\n        loaned : 0,\n        returned : 0,\n        outstanding : 0,\n        overdue : 0,\n        durations: [],\n        weeks : {}\n      });\n      _return.durations \u003d _return.durations.length ? Math.round(_return.durations.reduce((a, b) \u003d\u003e (a + b)) / _return.durations.length / 100 / 60 / 60) / 10 : 0;\n      if (config.get_capabilities_loan_requests()) {\n        var _requests \u003d _pending();\n        if (_requests \u0026\u0026 _requests.length \u003e 0) _return.requests \u003d _requests.length;\n      }\n      return _return;\n    },\n    \n    log_concluded : (params, user, claims) \u003d\u003e {\n      if (!claims || !(claims \u003d _claims(user, claims)).manage || \n        !config.get_capabilities_loan_requests() || !config.get_capabilities_loan()) return;\n      if (!params || !params.user || !params.id) return;\n      return _log.concluded(params, user);\n    },\n\n    log_loaned : (params, user, claims) \u003d\u003e {\n      if (!claims || !(claims \u003d _claims(user, claims)).manage || !config.get_capabilities_loan()) return;\n      if (!params || !params.user || !params.id) return;\n      return _log.loaned(params, user);\n    },\n    \n    log_returned : (params, user, claims) \u003d\u003e {\n      if (!claims || !(claims \u003d _claims(user, claims)).manage || !config.get_capabilities_loan()) return;\n      if (!params || !params.copy) return;\n      return _log.returned(params, user);\n    },\n    \n    users : (params, user, claims) \u003d\u003e {\n      if (!claims || !(claims \u003d _claims(user, claims)).manage) return;\n      return _users()\n        .filter((user) \u003d\u003e user.ID)\n        .map((user) \u003d\u003e {\n          var _return \u003d {\n            id: user.ID,\n            name: user.FULL_NAME,\n            display: user.DISPLAY_NAME,\n            link: user.LINK\n          };\n          if (params \u0026\u0026 params.notifications) _return.notifications_to \u003d user.NOTIFICATIONS_TO ? user.NOTIFICATIONS_TO.split(\"\\n\") : null;\n          return _return;\n        });\n    },\n    \n  };\n  \n};"},{"id":"5654b6d9-1089-4ced-9865-20ed363671d8","name":"Config","type":"server_js","source":"var config \u003d CONFIG.configure(PropertiesService.getScriptProperties(), {\n  description: {\n    name: \"DESCRIPTION\",\n    initial: \"Library\"\n  },\n  capabilities_loan: {\n    name: \"CAPABILITIES_LOAN\",\n    initial: false\n  },\n  capabilities_loan_field: {\n    name: \"CAPABILITIES_LOAN_FIELD\",\n    initial: \"\"\n  },\n  capabilities_loan_length: {\n    name: \"CAPABILITIES_LOAN_LENGTH\",\n    initial: 0\n  },\n  capabilities_loan_requests: {\n    name: \"CAPABILITIES_LOAN_REQUESTS\",\n    initial: false\n  },\n  capabilities_online_items: {\n    name: \"CAPABILITIES_ONLINE_ITEMS\",\n    initial: false\n  },\n  contents_books_audio: {\n    name: \"CONTENTS_BOOKS_AUDIO\",\n    initial: false\n  },\n  contents_books_electronic: {\n    name: \"CONTENTS_BOOKS_ELECTRONIC\",\n    initial: false\n  },\n  contents_books_physical: {\n    name: \"CONTENTS_BOOKS_PHYSICAL\",\n    initial: false\n  },\n  recent_items: {\n    name: \"RECENT_ITEMS\",\n    initial: 5\n  },\n  folder: {\n    name: \"FOLDER\",\n    initial: \"\"\n  },\n  database: {\n    name: \"DATABASE\",\n    initial: \"\"\n  },\n  managers: {\n    name: \"MANAGERS\",\n    initial: []\n  },\n  email_logo: {\n    name: \"EMAIL_LOGO\",\n    initial: \"1k4_cGivHqrAKbVadl6bLXOZvFbTvQRa1\"\n  },\n  email_overdue_subject: {\n    name: \"EMAIL_OVERDUE_SUBJECT\",\n    initial: \"Overdue Items\"\n  },\n  email_overdue_from: {\n    name: \"EMAIL_OVERDUE_FROM\",\n    initial: \"The Shelf Dog\"\n  },\n  email_overdue_preview: {\n    name: \"EMAIL_OVERDUE_PREVIEW\",\n    initial: \"Please return these items!\"\n  },\n  email_overdue_salutation: {\n    name: \"EMAIL_OVERDUE_SALUTATION\",\n    initial: \"Hi,\"\n  },\n  email_overdue_content: {\n    name: \"EMAIL_OVERDUE_CONTENT\",\n    initial: \"The following items seem to be __overdue__ from the library! Please can they be returned as soon as possible.\"\n  },\n  email_overdue_conclusion: {\n    name: \"EMAIL_OVERDUE_CONCLUSION\",\n    initial: \"If you don\u0027t think any of this data is correct, or you have any questions, please reply to this email or check [online](https://shelf.dog/app)!\"\n  },\n  email_overdue_valediction: {\n    name: \"EMAIL_OVERDUE_VALEDICTION\",\n    initial: \"Thanks!\"\n  }\n});"},{"id":"c3f0553b-3394-4ccf-87bb-e421a2e623c9","name":"Crypto","type":"server_js","source":"var PUBLIC_KEY \u003d \"{{{KEY}}}\";"},{"id":"27e400f0-0600-415d-8323-219a045afda0","name":"Versions","type":"server_js","source":"// -- All String Keys have to be quoted for JSON Parsing -- //\nvar VERSIONS \u003d [\n  {\n    \"v1_6_8\" : {\n      \"version\": \"1.6.8\",\n      \"description\": \"Request Methods\"\n    }\n  }, {\n    \"v1_5_0\" : {\n      \"version\": \"1.5.0\",\n      \"description\": \"Extra API Methods\"\n    }\n  }, {\n    \"v1_4_6\" : {\n      \"version\": \"1.4.6\",\n      \"description\": \"Email Notifications for Overdue Loans\"\n    }\n  }, {\n    \"v1_3_0\" : {\n      \"version\": \"1.3.0\",\n      \"description\": \"Download Items for Reading\"\n    }\n  }, {\n    \"v1_2_8\" : {\n      \"version\": \"1.2.8\",\n      \"description\": \"Loan Details\"\n    }\n  }, {\n    \"v1_2_7\" : {\n      \"version\": \"1.2.7\",\n      \"description\": \"User Search Links\"\n    }\n  }, {\n    \"v1_2_0\" : {\n      \"version\": \"1.2.0\",\n      \"description\": \"Overdue Loans\"\n    }\n  }, {\n    \"v1_1_9\" : {\n      \"version\": \"1.1.9\",\n      \"description\": \"Loan Lengths and Overdue Statistics\"\n    }\n  }, {\n    \"v1_1_4\" : {\n      \"version\": \"1.1.4\",\n      \"description\": \"Statistics\"\n    }\n  }, {\n    \"v1_1_0\" : {\n      \"version\": \"1.1.0\",\n      \"description\": \"Loans and Returns\"\n    }\n  }, {\n    \"v1_0_0\" : {\n      \"version\": \"1.0.0\",\n      \"description\": \"Initial Release Version\"\n    }\n  }\n];"},{"id":"bd9143ef-9452-4cd3-99bf-0e502803ae2a","name":"Notifications","type":"server_js","source":"function sendOverdueNotifications() {\n\n  // -- Helper Functions -- //\n  var _arrayise \u003d (value) \u003d\u003e value \u0026\u0026 typeof value \u003d\u003d\u003d \"object\" \u0026\u0026 value.constructor \u003d\u003d\u003d Array ?\n    value : typeof value \u003d\u003d\u003d \"string\" || value instanceof String ? [value] : [];\n  var _check \u003d (user, value) \u003d\u003e value \u0026\u0026 user ? \n      typeof value \u003d\u003d\u003d \"object\" \u0026\u0026 value.constructor \u003d\u003d\u003d Array ? value.indexOf(user) \u003e\u003d 0 : \n    new RegExp(Utilities.formatString(\"(^|,)(%s)(,|$)\", user.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$\u0026\")), \"i\").test(value) : \n    false;\n  var _unique \u003d (value) \u003d\u003e value.filter((value, index, self) \u003d\u003e self.indexOf(value) \u003d\u003d\u003d index);\n\n  \n  // -- UI Functions -- //\n  var notifyUser \u003d (message, title) \u003d\u003e title ? SpreadsheetApp.getActive().toast(message, title) : SpreadsheetApp.getActive().toast(message);\n  \n  // -- Authorisation Functions -- //\n  var _user \u003d Session.getActiveUser() ? Session.getActiveUser().getEmail() : \"\";\n  var _authorised \u003d _check(_user, config.get_managers());\n  if (!_authorised) return;\n  \n\n  // -- Get Loans and Users -- //\n  notifyUser(\"Loading Loans\");\n  var _api \u003d API(),\n      _loans \u003d _api.loans({overdue : true, details : true}, _user, {manage : true}),\n      _users \u003d _api.users({notifications : true}, _user, {manage : true});\n\n\n  // -- Process for Notifications -- //\n  notifyUser(\"Grouping Loans for Recipients\");\n  var _notify \u003d {}, _names \u003d {};\n  _loans.forEach((loan) \u003d\u003e {\n    if (loan.user \u0026\u0026 loan.user.toLowerCase) {\n      loan.user \u003d loan.user.toLowerCase();\n      if (!_notify[loan.user]) {\n        var users \u003d _users.filter((user) \u003d\u003e user.id \u0026\u0026 loan.user \u0026\u0026 user.id.toLowerCase() \u003d\u003d loan.user),\n            notify \u003d [];\n        if (users \u0026\u0026 users.length \u003e 0) {\n          _notify[loan.user] \u003d _unique(users.reduce((memo, user) \u003d\u003e memo.concat(_arrayise(user.notifications_to)), []));\n          _names[loan.user] \u003d users[0].name;\n        }\n      }\n      loan.notify \u003d _notify[loan.user];\n      loan.name \u003d _names[loan.user];\n    }\n  });\n  \n  var _recipients \u003d _loans.reduce((memo, loan) \u003d\u003e {\n    if (loan.notify) loan.notify.forEach((notify) \u003d\u003e {\n      memo[notify] \u003d memo[notify] ? memo[notify].concat([loan]) : [loan];\n      return memo;\n    });\n    return memo;\n  }, {});\n\n\n  // -- HTML Functions -- //\n  function _makeHtmlTable(data, widths, backgrounds, weights) {\n  \n    var index \u003d (value, row, col) \u003d\u003e value \u0026\u0026 value[row] \u0026\u0026 value[row][col] ? value[row][col] : null;\n    var format \u003d \u0027cellspacing\u003d\"2\" cellpadding\u003d\"2\" dir\u003d\"ltr\" border\u003d\"1\" style\u003d\"width:100%;table-layout:fixed;font-size:10pt;font-family:arial,sans,sans-serif;border-collapse:collapse;border:1px solid #ccc;font-weight:normal;color:black;background-color:white;text-align:center;text-decoration:none;font-style:normal;\u0027\n    var html \u003d \u0027\u003ctable \u0027 + format +\u0027 \"\u003e\u0027;\n  \n    for (row \u003d 0; row \u003c data.length; row++) {\n  \n      html +\u003d row \u003d\u003d\u003d 0 ? \u0027\u003ctr\u003e\u0027 : \u0027\u003ctr style\u003d\"font-size:8pt;\"\u003e\u0027;\n  \n      for (col \u003d 0; col \u003c data[row].length; col++) {\n      \n        if (data[row][col] \u003d\u003d\u003d \"\" || 0) {\n        \n          html +\u003d \u0027\u003ctd\u003e\u0027 + \u0027None\u0027 + \u0027\u003c/td\u003e\u0027;\n        \n        } else if (row \u003d\u003d\u003d 0)  {\n        \n          var _style \u003d \"background-color: #000000; color: #fef513; font-weight: bold;\";\n          if (widths \u0026\u0026 widths[col]) _style \u003d _style + \"width: \" + widths[col] + \";\"\n          html +\u003d \u0027\u003cth style\u003d\"\u0027 + _style + \u0027\"\u003e\u0027 + data[row][col] + \u0027\u003c/th\u003e\u0027;\n        \n        } else {\n        \n          var _style \u003d \"\";\n          if (index(backgrounds, row, col)) _style \u003d _style + (_style ? \" \" : \"\") + \"background-color: \" + index(backgrounds, row, col) + \";\";\n          if (index(weights, row, col) \u003d\u003d \"bold\") _style \u003d _style + (_style ? \" \" : \"\") + \"font-weight: bold;\";\n          \n          if (_style) {\n            html +\u003d \u0027\u003ctd style\u003d\"\u0027 + _style + \u0027\"\u003e\u0027 + data[row][col] + \u0027\u003c/td\u003e\u0027;\n          } else {\n            html +\u003d \u0027\u003ctd\u003e\u0027 + data[row][col] + \u0027\u003c/td\u003e\u0027;\n          }\n        \n        }\n  \n      }\n  \n      html +\u003d \u0027\u003c/tr\u003e\u0027;\n  \n    }\n  \n    html +\u003d \u0027\u003c/table\u003e\u0027;\n  \n    return html;\n  \n  };\n\n\n  // -- Get Converter / Sheet / Logo -- //\n  var __converter \u003d new SHOWDOWN.showdown.Converter(),\n      __convert \u003d (value) \u003d\u003e value ? __converter.makeHtml(value) : value;\n  \n  \n  // -- File / Image Configurable Values -- //\n  var __logo \u003d config.get_email_logo();    \n  if (__logo) __logo \u003d DriveApp.getFileById(__logo);\n  \n  \n  // -- Plain Text Configurable Values -- //\n  var __subject \u003d config.get_email_overdue_subject(),\n      __from \u003d config.get_email_overdue_from(),\n      __preview \u003d config.get_email_overdue_preview();\n  \n  \n  // -- Markdown / HTML Configurable Values -- //\n  var __salutation \u003d __convert(config.get_email_overdue_salutation()),\n      __content \u003d __convert(config.get_email_overdue_content()),\n      __conclusion \u003d __convert(config.get_email_overdue_conclusion()),\n      __valediction \u003d __convert(config.get_email_overdue_valediction());\n  \n    \n  // -- Email Functions -- //\n  var send \u003d function(\n    to, from, data, widths\n  ) {\n    \n    // -- Create Email -- //\n    var template \u003d HtmlService.createTemplateFromFile(\"Email\");\n    \n    // -- Merge Title -- //\n    template.TITLE \u003d __subject;\n    \n    // -- Merge Preview -- //\n    template.PREVIEW \u003d __preview;\n    \n    // -- Merge Salutation -- //\n    template.SALUTATION \u003d __salutation;\n  \n    // -- Merge Content -- //\n    template.CONTENT \u003d __content;\n    \n    // -- Merge Data -- //\n    template.DATA \u003d _makeHtmlTable(data, widths);\n    \n    // -- Merge Conclusion -- //\n    template.CONCLUSION \u003d __conclusion;\n    \n    // -- Merge Valediction -- //\n    template.VALEDICTION \u003d __valediction;\n    \n    // -- Merge Logo -- //\n    template.LOGO \u003d !!__logo;\n    \n    var html \u003d template.evaluate().getContent();\n    // -- Create Email -- //\n    \n    // -- Email Details -- //\n    var details \u003d {\n        from : from,\n        htmlBody: html,\n      };\n    if (__from) details.name \u003d __from;\n    if (__logo) details.inlineImages \u003d {\"shelfdog-logo\" : __logo};\n    \n    // -- Send Email -- //\n    GmailApp.sendEmail(\n      to,\n      __subject,\n      \"\",\n      details\n    );\n    \n    return true;\n    // -- Send Email -- //\n    \n  };\n  \n  \n  var _headers \u003d [[\"Who\", \"What\", \"When\"]],\n      _widths \u003d [\"25%\", \"55%\", \"20%\"],\n      _sorter \u003d (a, b) \u003d\u003e a \u003c b ? -1 : a \u003e b ? 1 : 0,\n      _sort \u003d (a, b) \u003d\u003e {\n        var _return \u003d _sorter(a.name.toUpperCase(), b.name.toUpperCase());\n        return _return \u003d\u003d\u003d 0 ? _sorter(a.date, b.date) : _return;\n      },\n      _filter \u003d (loan) \u003d\u003e loan.date \u0026\u0026 loan.details \u0026\u0026 loan.date,\n      _total \u003d Object.keys(_recipients).length,\n      _current \u003d 0;\n\n  for (var recipient in _recipients) {\n  \n    // -- Feedback to Calling User -- //\n    _current +\u003d 1;\n    notifyUser(Utilities.formatString(\"Sending Email %s of %s\", _current, _total));\n    \n    var _loans \u003d _recipients[recipient].filter(_filter).sort(_sort).map((loan) \u003d\u003e [\n        loan.name,\n        loan.details,\n        loan.date \u0026\u0026 loan.date.indexOf(\"T\") \u003e 0 ? loan.date.split(\"T\")[0] : loan.date\n      ]);\n\n    send(recipient, _user, _headers.concat(_loans), _widths);\n      \n  }\n  \n}"},{"id":"4d70d8d1-10b3-43f4-bda5-eaf9d3f5612b","name":"Email","type":"html","source":"\u003c!-- Simple Responsive Email Template - from https://github.com/leemunroe/responsive-html-email-template --\u003e\n\u003c!-- Licensed under the MIT License - see https://github.com/leemunroe/responsive-html-email-template/blob/master/license.txt --\u003e\n\u003c!doctype html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cmeta charset\u003d\"UTF-8\"\u003e\n    \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width\"\u003e\n    \u003cmeta http-equiv\u003d\"Content-Type\" content\u003d\"text/html; charset\u003dUTF-8\"\u003e\n    \u003ctitle\u003e\u003c?\u003d TITLE ?\u003e\u003c/title\u003e\n    \n    \u003c!-- All other clients get the webfont reference; some will render the font and others will silently fail to the fallbacks. More on that here: http://stylecampaign.com/blog/2015/02/webfont-support-in-email/ --\u003e\n\t\u003c!--[if !mso]\u003e\u003c!--\u003e\n\t\t\u003clink href\u003d\u0027https://fonts.googleapis.com/css2?family\u003dAcme:wght@400\u0026family\u003dPoppins:wght@400;700\u0026display\u003dswap\u0027 rel\u003d\u0027stylesheet\u0027 type\u003d\u0027text/css\u0027\u003e\n\t\u003c!--\u003c![endif]--\u003e\n    \n    \u003cstyle type\u003d\"text/css\"\u003e\n      /* \u003c!-- RESPONSIVE AND MOBILE FRIENDLY STYLES --\u003e */\n      @media only screen and (max-width: 620px) {\n        table[class\u003dbody] h1 {\n          font-size: 28px !important;\n          margin-bottom: 10px !important;\n        }\n        table[class\u003dbody] p,\n              table[class\u003dbody] ul,\n              table[class\u003dbody] ol,\n              table[class\u003dbody] td,\n              table[class\u003dbody] span,\n              table[class\u003dbody] a {\n          font-size: 16px !important;\n        }\n        table[class\u003dbody] .wrapper, table[class\u003dbody] .article {\n          padding: 10px !important;\n        }\n        table[class\u003dbody] .content {\n          padding: 0 !important;\n        }\n        table[class\u003dbody] .container {\n          padding: 0 !important;\n          width: 100% !important;\n        }\n        table[class\u003dbody] .main {\n          border-left-width: 0 !important;\n          border-radius: 0 !important;\n          border-right-width: 0 !important;\n        }\n        table[class\u003dbody] .btn table {\n          width: 100% !important;\n        }\n        table[class\u003dbody] .btn a {\n          width: 100% !important;\n        }\n        table[class\u003dbody] .img-responsive {\n          height: auto !important;\n          max-width: 100% !important;\n          width: auto !important;\n        }\n      }\n  \n      /* \u003c!-- PRESERVE THESE STYLES IN THE HEAD --\u003e */\n      @media all {\n        .ExternalClass {\n          width: 100%;\n        }\n        .ExternalClass,\n              .ExternalClass p,\n              .ExternalClass span,\n              .ExternalClass font,\n              .ExternalClass td,\n              .ExternalClass div {\n          line-height: 100%;\n        }\n        .apple-link a {\n          color: inherit !important;\n          font-family: inherit !important;\n          font-size: inherit !important;\n          font-weight: inherit !important;\n          line-height: inherit !important;\n          text-decoration: none !important;\n        }\n        .btn-primary table td:hover {\n          background-color: #d8d10d !important;\n        }\n        .btn-primary a:hover {\n          background-color: #d8d10d !important;\n          border-color: #d8d10d !important;\n        }\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody class\u003d\"\" style\u003d\"background-color: #000000; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;\"\u003e\n    \n    \u003c!-- EMAIL MARKUP | ACTION --\u003e\n    \u003cdiv itemscope itemtype\u003d\"http://schema.org/EmailMessage\"\u003e\n      \u003cdiv itemprop\u003d\"publisher\" itemscope itemtype\u003d\"http://schema.org/Organization\"\u003e\n        \u003cmeta itemprop\u003d\"name\" content\u003d\"SHELF.DOG\"/\u003e\n        \u003cmeta itemprop\u003d\"description\"\n              content\u003d\"Libraries, Simplified: Web-based book management\"/\u003e\n        \u003clink itemprop\u003d\"url\" href\u003d\"https://shelf.dog\"/\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \n    \u003ctable border\u003d\"0\" cellpadding\u003d\"0\" cellspacing\u003d\"0\" class\u003d\"body\" style\u003d\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background-color: #000000;\"\u003e\n      \u003ctr\u003e\n        \u003ctd style\u003d\"font-family: sans-serif; font-size: 14px; vertical-align: top;\"\u003e\u0026nbsp;\u003c/td\u003e\n        \u003ctd class\u003d\"container\" style\u003d\"font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; margin: 0 auto; max-width: 580px; padding: 10px; width: 580px;\"\u003e\n          \u003cdiv class\u003d\"content\" style\u003d\"box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;\"\u003e\n\n            \u003c!-- START CENTERED WHITE CONTAINER --\u003e\n            \u003cspan class\u003d\"preheader\" style\u003d\"color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;\"\u003e\u003c? if (PREVIEW) { ?\u003e\u003c?\u003d PREVIEW ?\u003e\u003c? } else { ?\u003eShelf Dog: \u003c?\u003d TITLE ?\u003e\u003c? } ?\u003e\u003c/span\u003e\n            \u003ctable class\u003d\"main\" style\u003d\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background: #ffffff; border-radius: 3px;\"\u003e\n\n              \u003c!-- START MAIN CONTENT AREA --\u003e\n              \u003ctr\u003e\n                \u003ctd class\u003d\"wrapper\" style\u003d\"font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding-left: 15px; padding-right: 15px; padding-top: 10px; padding-bottom: 10px;\"\u003e\n                  \u003ctable border\u003d\"0\" cellpadding\u003d\"0\" cellspacing\u003d\"0\" style\u003d\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\"\u003e\n                    \u003ctr\u003e\n                      \u003ctd style\u003d\"font-family: sans-serif; vertical-align: top;\"\u003e\n                      \n                        \u003c? if (SALUTATION) { ?\u003e\u003cdiv style\u003d\"font-family: Acme,\u0027Google Sans\u0027,roboto,sans-serif; font-size: 22px; font-weight: normal; margin: 0; margin-bottom: 20px;\"\u003e\u003c?!\u003d SALUTATION ?\u003e\u003c/div\u003e\u003c? } ?\u003e\n                        \n                        \u003c? if (CONTENT) { ?\u003e\u003cdiv style\u003d\"font-family: Poppins,roboto,sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\"\u003e\u003c?!\u003d CONTENT ?\u003e\u003c/div\u003e\u003c? } ?\u003e\n                        \n                        \u003c!-- Table : BEGIN --\u003e\n                        \u003c? if (DATA) { ?\u003e\u003cdiv style\u003d\"font-family: Poppins,roboto,sans-serif; font-size: 10px; font-weight: normal; margin: 0; margin-bottom: 5px;\"\u003e\u003c?!\u003d DATA ?\u003e\u003c/div\u003e\u003c? } ?\u003e\n                        \u003c!-- Table : END --\u003e\n                        \n                        \u003c? if (CONCLUSION) { ?\u003e\u003cdiv style\u003d\"font-family: Poppins,roboto,sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\"\u003e\u003c?!\u003d CONCLUSION ?\u003e\u003c/div\u003e\u003c? } ?\u003e\n                        \n                        \u003c? if (VALEDICTION) { ?\u003e\u003cdiv style\u003d\"font-family: Acme,\u0027Google Sans\u0027,roboto,sans-serif; font-size: 18px; font-weight: normal; margin: 0; Margin-bottom: 16px;\"\u003e\u003c?!\u003d VALEDICTION ?\u003e\u003c/div\u003e\u003c? } ?\u003e\n                        \n                      \u003c/td\u003e\n                    \u003c/tr\u003e\n                  \u003c/table\u003e\n                \u003c/td\u003e\n              \u003c/tr\u003e\n\n              \u003c!-- Hero Image, Flush : BEGIN --\u003e\n              \u003c? if (LOGO) { ?\u003e\u003ctr style\u003d\"background-color: #ffffff;\"\u003e\n                \u003ctd align\u003d\"center\"\u003e\n                  \u003ca href\u003d\"https://shelf.dog\" align\u003d\"center\" style\u003d\"text-align: center;\"\u003e\n                    \u003cimg src\u003d\"cid:shelfdog-logo\" width\u003d\"345\" height\u003d\"\" alt\u003d\"Shelf Dog Logo\" border\u003d\"0\" align\u003d\"center\" style\u003d\"width: 50%; padding-left: 25%; padding-right: 25%; max-width: 800px; text-align: center;\"/\u003e\n                  \u003c/a\u003e\n                \u003c/td\u003e\n              \u003c/tr\u003e\u003c? } ?\u003e\n              \u003c!-- Hero Image, Flush : END --\u003e\n                \n            \u003c!-- END MAIN CONTENT AREA --\u003e\n            \u003c/table\u003e\n\n            \u003c!-- START FOOTER --\u003e\n            \u003cdiv class\u003d\"footer\" style\u003d\"clear: both; margin-top: 10px; text-align: center; width: 100%;\"\u003e\n              \u003ctable border\u003d\"0\" cellpadding\u003d\"0\" cellspacing\u003d\"0\" style\u003d\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\"\u003e\n                \u003ctr\u003e\n                  \u003ctd class\u003d\"content-block powered-by\" style\u003d\"font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; font-size: 12px; color: #999999; text-align: center;\"\u003e\n                    \u003ca href\u003d\"https://shelf.dog\" style\u003d\"color: #fef513; font-size: 12px; text-align: center; text-decoration: none;\"\u003eSHELF.DOG\u003c/a\u003e | Libraries, \u003cstrong style\u003d\"color: #dddddd;\"\u003eSimplified\u003c/strong\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n              \u003c/table\u003e\n            \u003c/div\u003e\n            \u003c!-- END FOOTER --\u003e\n\n          \u003c!-- END CENTERED WHITE CONTAINER --\u003e\n          \u003c/div\u003e\n        \u003c/td\u003e\n        \u003ctd style\u003d\"font-family: sans-serif; font-size: 14px; vertical-align: top;\"\u003e\u0026nbsp;\u003c/td\u003e\n      \u003c/tr\u003e\n    \u003c/table\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"}]}